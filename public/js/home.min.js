
var config={scrollOffsetForLoadMore:300,scrollTimerForLoadMore:50,photoPerPage:12};var latestFullPhotoObject=null;var photoTemplate,fullPhotoTemplate,albumTemplate;photoTemplate='<div class="photoContainer">            <div class="photo" id="photo_{{id}}" style="background-image: url(\'/public/images/thumb/{{img}}\')">            </div>            <div class="title">                <div class="titleText">{{title}}</div>                <div class="likeAndFavContainer">                    <ul class="hl">                        <li class="likeIcon">                            <img src="/public/images/img/like_normal.png" id="like_{{id}}" data-id="{{id}}">                            <img src="/public/images/img/like_highlight.png" id="dislike_{{id}}" data-id="{{id}}">                        </li>                        <li class="favIcon">                            <img src="/public/images/img/fav_normal.png" id="fav_{{id}}" data-id="{{id}}">                            <img src="/public/images/img/fav_highlight.png" id="unfav_{{id}}" data-id="{{id}}">                        </li>                    </ul>                </div>            </div>        </div>';fullPhotoTemplate='<div class="fullScreenPhoto">            <div class="close" onclick="closeFullScreenPhoto()">X</div>            <div class="photoHolder">                <div class="previousFullPhoto" id="previousFullPhoto">                    <span>&lt;</span>                </div>                <div class="nextFullPhoto" id="nextFullPhoto">                    <span>&gt;</span>                </div>                <img src="/public/images/compressed/{{img}}">            </div>            <div class="photoDetailHolder">                <div class="userInfo">                    <img src="/public/images/profile_img/{{user_img}}">                    <a href="/user/{{username}}">{{username}}</a>                </div>                <div class="title">{{title}}</div>                <div>                    <ul class="hl likeFavViewContainer">                        <li>                            <ul class="hl ">                                <li class="word" id="like_{{id}}">Like</li>                                <li class="word likehighlight" id="dislike_{{id}}">Like</li>                                <li class="count likehighlight" id="likeCount_{{id}}">12</li>                            </ul>                        </li>                        <li>                            <ul class="hl">                                <li class="word" id="fav_{{id}}">Favorite</li>                                <li class="word favhighlight" id="unfav_{{id}}">Favorite</li>                                <li class="count favhighlight" id="favCount_{{id}}">12</li>                            </ul>                        </li>                        <li>                            <ul class="hl">                                <li class="word">View</li><li class="count viewhighlight" id="viewCount_{{id}}">12</li>                            </ul>                        </li>                    </ul>                </div>                <div class="viewFullPhoto">                    <a href="/photo/{{url}}"><button>View Full Photo</button></a>                </div>                <div>                    <table class="photoDetailTable">                        <tbody><tr><th>Name</th><th>Description</th></tr>                        <tr><td>Album</td><td><a href="/album/{{albumurl}}" title="{{album}}">{{album}}</a></td></tr>                        <tr><td>Width</td><td>{{width}}</td></tr>                        <tr><td>Height</td><td>{{height}}</td></tr>                        <tr><td>Size</td><td>{{size}}</td></tr>                    </tbody></table>                </div><div class="fullPhotoColorPalatteTitle">Color Palette</div> <div id="fullPhotoColorPalatte" class="fullPhotoColorPalatte"></div>           </div>        </div>';albumTemplate='<div class="album">            <div class="albumTitle">                {{album}}                <a href="/album/{{albumurl}}" class="seeAll">See All Photo</a>            </div>            <a href="/album/{{albumurl}}">                <div class="imgage" style="background-image: url(/public/images/compressed/{{img}});"></div>            </a>        </div>';$(window).on("load",function(){$(window).on("click",function(){if($("#hiddenTopMoreOptionContainer").css("display")=="block"){toggleMoreOption()}})});function displayPhotos(c){for(photoJSONIndex in c.data){var b=c.data[photoJSONIndex];var g=b.title;g=g.replace(/#(\S*)/g,'<a href="/hash/$1">#$1</a>');var a=photoTemplate;a=a.replace(/\{\{id\}\}/g,b.imgid);a=a.replace(/\{\{title\}\}/g,g);a=a.replace(/\{\{img\}\}/g,b.img);$("#"+c.id).append(a);if(b.likecount=="0"){$("#like_"+b.imgid).show();$("#dislike_"+b.imgid).hide()}else{$("#like_"+b.imgid).hide();$("#dislike_"+b.imgid).show()}$("#like_"+b.imgid).on("click",likePhoto.bind(b));$("#dislike_"+b.imgid).on("click",dislikePhoto.bind(b));if(b.favcount=="0"){$("#fav_"+b.imgid).show();$("#unfav_"+b.imgid).hide()}else{$("#fav_"+b.imgid).hide();$("#unfav_"+b.imgid).show()}$("#fav_"+b.imgid).on("click",favPhoto.bind(b));$("#unfav_"+b.imgid).on("click",unfavPhoto.bind(b));$("#photo_"+b.imgid).on("click",showFullScreenPhoto.bind(b))}setTimeout(checkPhotoCountForEmptyAndThreshold,100)}function checkPhotoCountForEmptyAndThreshold(){if($(".photoContainer").length<config.photoPerPage){$("#messageFooter").show()}}function showFullScreenPhoto(){var a=this;$.ajax({type:"post",url:"/photo/info",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#fullScreenPhoto").show()},success:function(g){e(g);latestFullPhotoObject=g;if(g.code==1){var h=fullPhotoTemplate;var l=g.title;l=l.replace(/#(\S*)/g,'<a href="/hash/$1">#$1</a>');h=h.replace(/\{\{user_img\}\}/g,g.usericon);h=h.replace(/\{\{username\}\}/g,g.username);h=h.replace(/\{\{url\}\}/g,g.url);h=h.replace(/\{\{title\}\}/g,l);h=h.replace(/\{\{img\}\}/g,a.img);h=h.replace(/\{\{id\}\}/g,a.imgid);h=h.replace(/\{\{album\}\}/g,g.albumname);h=h.replace(/\{\{albumurl\}\}/g,g.albumurl);h=h.replace(/\{\{width\}\}/g,g.width);h=h.replace(/\{\{height\}\}/g,g.height);h=h.replace(/\{\{size\}\}/g,g.size);$("#fullScreenPhoto").text(h);$("#likeCount_"+a.imgid).text(g.likecount);$("#favCount_"+a.imgid).text(g.favcount);$("#viewCount_"+a.imgid).text(g.viewcount);if(g.userlike=="0"){$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide()}else{$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show()}if(g.userfav=="0"){$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide()}else{$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show()}$(window).on("keydown",instantCloseFullScreenPhoto);$("#like_"+a.imgid).on("click",fullScreenLikePhoto.bind(a));$("#dislike_"+a.imgid).on("click",fullScreenDislikePhoto.bind(a));$("#fav_"+a.imgid).on("click",fullScreenFavPhoto.bind(a));$("#unfav_"+a.imgid).on("click",fullScreenUnfavPhoto.bind(a));if(g.previous!=false){$("#previousFullPhoto").show();$("#previousFullPhoto").html("<span>&lt;</span>");$("#previousFullPhoto span").on("click",showFullScreenPhoto.bind(g.previous))}else{$("#previousFullPhoto").hide()}if(g.next!=false){$("#nextFullPhoto").show();$("#nextFullPhoto").html("<span>&gt;</span>");$("#nextFullPhoto span").on("click",showFullScreenPhoto.bind(g.next))}else{$("#nextFullPhoto").hide()}var k="";for(i=0;i<g.extra.length;i++){var b=g.extra[i];if(b.meta_key.startsWith("Palette_")){var c=(b.meta_value);k+="<div style='background-color:#"+c+"' class='paletteColorBox'></div>"}}$("#fullPhotoColorPalatte").text(k)}else{addMessageBox(1,g.message)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection")}})}function displayAlbums(c){for(albumJSONIndex in c.data){var a=c.data[albumJSONIndex];var b=albumTemplate;b=b.replace(/\{\{album\}\}/g,a.album);b=b.replace(/\{\{albumurl\}\}/g,a.albumurl);b=b.replace(/\{\{img\}\}/g,a.img);$("#"+c.id).append(b)}}function likePhoto(b){var a=this;$.ajax({type:"post",url:"/photo/like",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show()},success:function(c){if(c.code==1){$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show()}else{$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide();addMessageBox(1,c.message)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide()}})}function dislikePhoto(){var a=this;$.ajax({type:"post",url:"/photo/dislike",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide()},success:function(b){if(b.code==1){$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide()}else{$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show();addMessageBox(1,b.message)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show()}})}function favPhoto(){var a=this;$.ajax({type:"post",url:"/photo/fav",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show()},success:function(b){if(b.code==1){$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show()}else{$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide();addMessageBox(1,b.message)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide()}})}function unfavPhoto(){var a=this;$.ajax({type:"post",url:"/photo/unfav",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide()},success:function(b){if(b.code==1){$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide()}else{$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show();addMessageBox(1,b.message)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show()}})}function fullScreenLikePhoto(){var a=this;$.ajax({type:"post",url:"/photo/like",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show();var b=parseInt($("#likeCount_"+a.imgid).text());b++;$("#likeCount_"+a.imgid).text(b)},success:function(b){if(b.code==1){$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show()}else{$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide();addMessageBox(1,b.message);var c=parseInt($("#likeCount_"+a.imgid).text());c--;$("#likeCount_"+a.imgid).text(c)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide();var b=parseInt($("#likeCount_"+a.imgid).text());b--;$("#likeCount_"+a.imgid).text(b)}})}function fullScreenDislikePhoto(){var a=this;$.ajax({type:"post",url:"/photo/dislike",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide();var b=parseInt($("#likeCount_"+a.imgid).text());b--;$("#likeCount_"+a.imgid).text(b)},success:function(b){if(b.code==1){$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide()}else{$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show();addMessageBox(1,b.message);var c=parseInt($("#likeCount_"+a.imgid).text());c++;$("#likeCount_"+a.imgid).text(c)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show();var b=parseInt($("#likeCount_"+a.imgid).text());b++;$("#likeCount_"+a.imgid).text(b)}})}function fullScreenFavPhoto(){var a=this;$.ajax({type:"post",url:"/photo/fav",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show();var b=parseInt($("#favCount_"+a.imgid).text());b++;$("#favCount_"+a.imgid).text(b)},success:function(b){if(b.code==1){$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show()}else{$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide();addMessageBox(1,b.message);var c=parseInt($("#favCount_"+a.imgid).text());c--;$("#favCount_"+a.imgid).text(c)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide();var b=parseInt($("#favCount_"+a.imgid).text());b--;$("#favCount_"+a.imgid).text(b)}})}function fullScreenUnfavPhoto(){var a=this;$.ajax({type:"post",url:"/photo/unfav",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide();var b=parseInt($("#favCount_"+a.imgid).text());b--;$("#favCount_"+a.imgid).text(b)},success:function(b){if(b.code==1){$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide()}else{$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show();addMessageBox(1,b.message);var c=parseInt($("#favCount_"+a.imgid).text());c++;$("#favCount_"+a.imgid).text(c)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show();var b=parseInt($("#favCount_"+a.imgid).text());b++;$("#favCount_"+a.imgid).text(b)}})}function closeFullScreenPhoto(){$("#fullScreenPhoto").hide();$(window).off("keydown",instantCloseFullScreenPhoto)}function instantCloseFullScreenPhoto(){if(event.keyCode==27){closeFullScreenPhoto()}}function toggleMoreOption(){$("#hiddenTopMoreOptionContainer").toggle()}function addMessageBox(a,g){id="messageBox_"+(new Date()).getTime()+Math.ceil(Math.random()*200);var c='<div class="messageBox '+((a===0)?"messageBoxGreen":"messageBoxRed")+'" id="'+id+'">                <ul class="hl">                    <li>'+g+'</li>                    <li class="close" onclick="closeMessageBox(\''+id+"')\">x</li>                </ul>            </div>";$("#rightMessageBox").appendStart(c);var b={boxid:id};f=showMessageBox.bind(b);setTimeout(f,0)}function showMessageBox(){$("#"+this.boxid).css("opacity:1;");f=hideMessageBox.bind(this);setTimeout(f,3000)}function hideMessageBox(){$("#"+this.boxid).css("opacity:0;");f=removeMessageBox.bind(this);setTimeout(f,500)}function removeMessageBox(){$("#"+this.boxid).remove()}function closeMessageBox(b){var a={boxid:b};f=hideMessageBox.bind(a);setTimeout(f,0)}function userAlbumScrollHandlerWithTime(){clearInterval(userAlbumScrollTimer);userAlbumScrollTimer=setTimeout(userAlbumScrollHandler,config.scrollTimerForLoadMore)}function userAlbumScrollHandler(){var g=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var c=(document.documentElement&&document.documentElement.scrollHeight)||document.body.scrollHeight;var b=(g+window.innerHeight+config.scrollOffsetForLoadMore)>=c;var a=$("#messageFooter").css("display")=="block"?true:false;if(b&&!a){userAlbumLoadMore()}}function userAlbumLoadMore(){var a=albumsJSON[albumsJSON.length-1];if(latestPhotoSent==a){return}else{latestPhotoSent=a;$.ajax({type:"post",url:"/user/more",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#loadingFooter").show();$("#retryFooter").hide()},success:function(b){e(b);if(b.code==1){albumsJSON.push.apply(albumsJSON,b.photos);displayAlbums({data:b.photos,id:"albumContainer"});if(b.photos.length==0){$(window).off("scroll",userAlbumScrollHandlerWithTime);$("#messageFooter").show()}else{$("#messageFooter").hide()}}else{addMessageBox(1,b.message)}},end:function(){$("#loadingFooter").hide();latestPhotoSent=null},failure:function(){$("#retryFooter").show()}})}}function userPhotoScrollHandlerWithTime(){clearInterval(userPhotoScrollTimer);userPhotoScrollTimer=setTimeout(userPhotoScrollHandler,config.scrollTimerForLoadMore)}function userPhotoScrollHandler(){var g=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var c=(document.documentElement&&document.documentElement.scrollHeight)||document.body.scrollHeight;var b=(g+window.innerHeight+config.scrollOffsetForLoadMore)>=c;var a=$("#messageFooter").css("display")=="block"?true:false;if(b&&!a){userPhotoLoadMore()}}function userPhotoLoadMore(){var a=photosJSON[photosJSON.length-1];$.ajax({type:"post",url:"/user/more",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#loadingFooter").show();$("#retryFooter").hide()},success:function(b){if(b.code==1){photosJSON.push.apply(photosJSON,b.photos);displayPhotos({data:b.photos,id:"photoContainer"});if(b.photos.length==0){$(window).off("scroll",userPhotoScrollHandlerWithTime);$("#messageFooter").show()}else{$("#messageFooter").hide()}}else{addMessageBox(1,b.message)}},end:function(){$("#loadingFooter").hide()},failure:function(){$("#retryFooter").show()}})}function homeScrollHandlerWithTime(){clearInterval(homeScrollTimer);homeScrollTimer=setTimeout(homeScrollHandler,config.scrollTimerForLoadMore)}function homeScrollHandler(){var g=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var c=(document.documentElement&&document.documentElement.scrollHeight)||document.body.scrollHeight;var b=(g+window.innerHeight+config.scrollOffsetForLoadMore)>=c;var a=$("#messageFooter").css("display")=="block"?true:false;if(b&&!a){homeLoadMore()}}var latestPhotoSent;function homeLoadMore(){var a=photosJSON[photosJSON.length-1];if(latestPhotoSent==a){return}else{latestPhotoSent=a;$.ajax({type:"post",url:"/home/more",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#loadingFooter").show();$("#retryFooter").hide()},success:function(b){if(b.code==1){photosJSON.push.apply(photosJSON,b.photos);displayPhotos({data:b.photos,id:"photoContainer"});if(b.photos.length==0){$("#messageFooter").show()}else{$("#messageFooter").hide()}}else{addMessageBox(1,b.message)}},end:function(){$("#loadingFooter").hide();latestPhotoSent=null},failure:function(){$("#retryFooter").show()}})}}function hashScrollHandlerWithTime(){clearInterval(hashScrollTimer);hashScrollTimer=setTimeout(hashScrollHandler,config.scrollTimerForLoadMore)}function hashScrollHandler(){var g=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var c=(document.documentElement&&document.documentElement.scrollHeight)||document.body.scrollHeight;var b=(g+window.innerHeight+config.scrollOffsetForLoadMore)>=c;var a=$("#messageFooter").css("display")=="block"?true:false;if(b&&!a){hashLoadMore()}}function hashLoadMore(){var a=photosJSON[photosJSON.length-1];if(latestPhotoSent==a){return}else{latestPhotoSent=a;$.ajax({type:"post",url:"/hash/more",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#loadingFooter").show();$("#retryFooter").hide()},success:function(b){if(b.code==1){photosJSON.push.apply(photosJSON,b.photos);displayPhotos({data:b.photos,id:"photoContainer"});if(b.photos.length==0){$("#messageFooter").show()}else{$("#messageFooter").hide()}}else{addMessageBox(1,b.message)}},end:function(){$("#loadingFooter").hide();latestPhotoSent=null},failure:function(){$("#retryFooter").show()}})}}function albumScrollHandlerWithTime(){clearInterval(albumScrollTimer);albumScrollTimer=setTimeout(albumScrollHandler,config.scrollTimerForLoadMore)}function albumScrollHandler(){var g=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var c=(document.documentElement&&document.documentElement.scrollHeight)||document.body.scrollHeight;var b=(g+window.innerHeight+config.scrollOffsetForLoadMore)>=c;var a=$("#messageFooter").css("display")=="block"?true:false;if(b&&!a){albumLoadMore()}}function albumLoadMore(){var a=photosJSON[photosJSON.length-1];if(latestPhotoSent==a){return}else{latestPhotoSent=a;$.ajax({type:"post",url:"/album/more",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#loadingFooter").show();$("#retryFooter").hide()},success:function(b){if(b.code==1){photosJSON.push.apply(photosJSON,b.photos);displayPhotos({data:b.photos,id:"photoContainer"});if(b.photos.length==0){$("#messageFooter").show()}else{$("#messageFooter").hide()}}else{addMessageBox(1,b.message)}},end:function(){$("#loadingFooter").hide();latestPhotoSent=null},failure:function(){$("#retryFooter").show()}})}}function editorScrollHandlerWithTime(){clearInterval(editorScrollTimer);editorScrollTimer=setTimeout(editorScrollHandler,config.scrollTimerForLoadMore)}function editorScrollHandler(){var g=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var c=(document.documentElement&&document.documentElement.scrollHeight)||document.body.scrollHeight;var b=(g+window.innerHeight+config.scrollOffsetForLoadMore)>=c;var a=$("#messageFooter").css("display")=="block"?true:false;if(b&&!a){editorLoadMore()}}function editorLoadMore(){var a=photosJSON[photosJSON.length-1];if(latestPhotoSent==a){return}else{latestPhotoSent=a;$.ajax({type:"post",url:"/editor/more",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#loadingFooter").show();$("#retryFooter").hide()},success:function(b){if(b.code==1){photosJSON.push.apply(photosJSON,b.photos);displayPhotos({data:b.photos,id:"photoContainer"});if(b.photos.length==0){$("#messageFooter").show()}else{$("#messageFooter").hide()}}else{addMessageBox(1,b.message)}},end:function(){$("#loadingFooter").hide();latestPhotoSent=null},failure:function(){$("#retryFooter").show()}})}}function saveUserProfileCover(){var c=document.getElementById("userCoverUploadFile");var b=c.files[0];if(b.type==undefined||b.size==0){addMessageBox(1,"Unknown File");return}var a=new FormData();a.append("cover",b);ajax=new XMLHttpRequest();ajax.upload.addEventListener("progress",profileProgressHandler,false);ajax.addEventListener("load",profileCompleteHandler,false);ajax.open("POST","/upload/cover");ajax.send(a)}function profileProgressHandler(b){var a=(b.loaded/b.total)*100;$("#uploadProgressBar").css("width:"+a+"%")}function profileCompleteHandler(a){$("#uploadProgressBar").css("width:0%");rawInfo=ajax.responseText;info=JSON.parse(ajax.responseText);if(info.code==101){window.location.href="/account/login"}else{if(info.code==1){addMessageBox(0,info.message)}else{addMessageBox(1,info.message)}}$("#changeUserProfileCoverSave").hide()}function saveUserProfileIcon(){var c=document.getElementById("userIconUploadFile");var b=c.files[0];if(b.type==undefined||b.size==0){addMessageBox(1,"Unknown File");return}var a=new FormData();a.append("cover",b);ajax=new XMLHttpRequest();ajax.upload.addEventListener("progress",profileIconProgressHandler,false);ajax.addEventListener("load",profileIconCompleteHandler,false);ajax.open("POST","/upload/icon");ajax.send(a)}function profileIconProgressHandler(b){var a=(b.loaded/b.total)*100;$("#uploadProgressBar").css("width:"+a+"%")}function profileIconCompleteHandler(a){$("#uploadProgressBar").css("width:0%");rawInfo=ajax.responseText;info=JSON.parse(ajax.responseText);if(info.code==101){window.location.href="/account/login"}else{if(info.code==1){addMessageBox(0,info.message)}else{addMessageBox(1,info.message)}}$("#changeUserProfileIconSave").hide()}function showPreviewProfileCover(){var h=document.getElementById("userCoverUploadFile");if(h.files&&h.files[0]){for(j=0;j<h.files.length;j++){var g,k,c,b=new FileReader;b.onload=function(l){var m=l.target.result;d=document.createElement("img");d.src=m;g=d.width;k=d.height;c=l.size;$("#userProfileCoverPhoto").css("background-image:url("+d.src+")");$("#changeUserProfileCoverSave").show()},b.onerror=function(a){console.error("File could not be read! Code "+a.target.error.code)},b.readAsDataURL(h.files[j])}}}function showPreviewProfileIcon(){var h=document.getElementById("userIconUploadFile");if(h.files&&h.files[0]){for(j=0;j<h.files.length;j++){var g,k,c,b=new FileReader;b.onload=function(l){var m=l.target.result;d=document.createElement("img");d.src=m;g=d.width;k=d.height;c=l.size;$("#userProfileIconPhoto").css("background-image:url("+d.src+")");$("#changeUserProfileIconSave").show()},b.onerror=function(a){console.error("File could not be read! Code "+a.target.error.code)},b.readAsDataURL(h.files[j])}}}function instantSearch(){clearInterval(searchPhotoTimer);searchPhotoTimer=setTimeout(searchPhoto,20)}function searchPhoto(){var b=$("#searchBoxINput").val();var c=$("#searchType").val();var g=window.location.search;g=replaceQueryParam("search",b,g);g=replaceQueryParam("type",c.toLowerCase(),g);if(history.pushState){var a=window.location.protocol+"//"+window.location.host+window.location.pathname+g;window.history.pushState({path:a},"",a)}$.ajax({type:"post",url:"/search/get",async:true,dataType:"json",data:{searchTerm:b,searchType:c},start:function(){$("#messageFooter").hide()},success:function(h){e(h);if(h.code==1){if(h.type=="photo"){$("#photoContainer").html("");photosJSON.push.apply(photosJSON,h.photos);displayPhotos({data:h.photos,id:"photoContainer"})}else{if(h.type=="user"){$("#photoContainer").html("");userJSON.push.apply(userJSON,h.users);displayUser({data:h.users,id:"photoContainer"})}}$("#searchQueryExecutionTime").text("Search took "+h.query_time+" seconds")}else{addMessageBox(1,h.message)}},end:function(){},failure:function(){}})}function displayUser(b){for(photoJSONIndex in b.data){var c=b.data[photoJSONIndex];var a=$("#userSearchTemplate").text();a=a.replace(/\{\{img\}\}/g,c.img);a=a.replace(/\{\{cover\}\}/g,c.cover);a=a.replace(/\{\{username\}\}/g,c.username);$("#"+b.id).append(a)}setTimeout(checkUserCountForEmptyAndThreshold,100)}function checkUserCountForEmptyAndThreshold(){if($(".userSearch").length<config.photoPerPage){$("#messageFooter").show()}}function searchScrollHandlerWithTime(){clearInterval(searchScrollTimer);searchScrollTimer=setTimeout(searchScrollHandler,50)}function searchScrollHandler(){var g=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var c=(document.documentElement&&document.documentElement.scrollHeight)||document.body.scrollHeight;var b=(g+window.innerHeight+200)>=c;var a=$("#messageFooter").css("display")=="block"?true:false;if(b&&!a){searchLoadMore()}}function searchLoadMore(){var b=$("#searchType").val();if(b=="photo"){var a=photosJSON[photosJSON.length-1]}else{var a=userJSON[userJSON.length-1]}if(latestPhotoSent==a){return}else{latestPhotoSent=a;$.ajax({type:"post",url:"/search/more",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#loadingFooter").show();$("#retryFooter").hide();$("#messageFooter").hide()},success:function(c){e(c);if(c.code==1){if(c.type=="photo"){photosJSON.push.apply(photosJSON,c.photos);displayPhotos({data:c.photos,id:"photoContainer"});if(c.photos.length==0){$("#messageFooter").show()}else{$("#messageFooter").hide()}}else{if(c.type=="people"){userJSON.push.apply(userJSON,c.users);displayUser({data:c.users,id:"photoContainer"});if(c.users.length==0){$("#messageFooter").show()}else{$("#messageFooter").hide()}}}}else{addMessageBox(1,c.message)}},end:function(){$("#loadingFooter").hide();latestPhotoSent=null},failure:function(){$("#retryFooter").show()}})}}function replaceQueryParam(h,g,a){var b=new RegExp("([?;&])"+h+"[^&;]*[;&]?");var c=a.replace(b,"$1").replace(/&$/,"");return(c.length>2?c+"&":"?")+(g?h+"="+g:"")};