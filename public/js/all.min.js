
function e(a){console.log(a)}function _(a){return document.getElementById(a)}function $(a){return new IniteditJSLib(a)}if(!Array.from){Array.from=(function(){var g=Object.prototype.toString;var h=function(l){return typeof l==="function"||g.call(l)==="[object Function]"};var c=function(m){var l=Number(m);if(isNaN(l)){return 0}if(l===0||!isFinite(l)){return l}return(l>0?1:-1)*Math.floor(Math.abs(l))};var b=Math.pow(2,53)-1;var a=function(m){var l=c(m);return Math.min(Math.max(l,0),b)};return function k(t){var l=this;var s=Object(t);if(t==null){throw new TypeError("Array.from requires an array-like object - not null or undefined")}var q=arguments.length>1?arguments[1]:void undefined;var n;if(typeof q!=="undefined"){if(!h(q)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){n=arguments[2]}}var r=a(s.length);var m=h(l)?Object(new l(r)):new Array(r);var o=0;var p;while(o<r){p=s[o];if(q){m[o]=typeof n==="undefined"?q(p,o):q.call(n,p,o)}else{m[o]=p}o+=1}m.length=r;return m}}())}function IniteditJSLib(a){this.element=[];if(typeof a=="string"){this.element=document.querySelectorAll(a)}else{if(typeof a=="object"){if(a.hasOwnProperty("_getStyle")){COST=a;e(COST);this.element=(Array.from(a.element)).slice()}else{this.element[0]=a}}}this.length=Array.from(this.element).length;this.CUSTOME=function(){};this._getStyle=function(c,b){var h,g=(document).defaultView;if(g&&g.getComputedStyle){b=b.replace(/([A-Z])/g,"-$1").toLowerCase();return g.getComputedStyle(c,null).getPropertyValue(b)}else{if(c.currentStyle){b=b.replace(/\-(\w)/g,function(l,k){return k.toUpperCase()});h=c.currentStyle[b];if(/^\d+(em|pt|%|ex)?$/i.test(h)){return(function(k){var m=c.style.left,l=c.runtimeStyle.left;c.runtimeStyle.left=c.currentStyle.left;c.style.left=k||0;k=c.style.pixelLeft+"px";c.style.left=m;c.runtimeStyle.left=l;return k})(h)}return h}}};this.elements=function(){return Array.from(this.element)};this.count=function(){return Array.from(this.element).length};this.height=function(){return this.element[0].clientHeight};this.actualHeight=function(){return this.element[0].offsetHeight};this.width=function(){return this.element[0].clientWidth};this.actualWidth=function(){return this.element[0].offsetWidth};this.offset=function(){return{top:this.element[0].offsetTop,left:this.element[0].offsetLeft}};this.scrollDown=function(){for(var b=0;b<this.element.length;b++){this.element[b].scrollTop=this.element[b].scrollHeight}return this};this.scrollTo=function(){for(var b=0;b<this.element.length;b++){this.element[b].scrollTop=arguments[0]}return this};this.isChecked=function(){for(var b=0;b<this.element.length;b++){if(!(this.element[b].checked)){return false}}return true};this.toggleCheck=function(){for(var b=0;b<this.element.length;b++){if((this.element[b].checked)){this.element[b].checked=false}else{this.element[b].checked=true}}return true};this.dump=function(){console.log(this.element)};this.hide=function(){for(var b=0;b<this.element.length;b++){this.element[b].style.display="none"}return this};this.show=function(){for(var b=0;b<this.element.length;b++){this.element[b].style.display="block"}return this};this.toggle=function(){for(var c=0;c<this.element.length;c++){var b=this.element[c];if(this._getStyle(b,"display")=="none"){b.style.display="block"}else{b.style.display="none"}}return this};this.text=function(){if(arguments.length==0){return this.element[0].innerHTML}else{for(var c=0;c<this.element.length;c++){var b=this.element[c];b.innerHTML=arguments[0]}return this}};this.html=function(){if(arguments.length==0){return this.element[0].innerHTML}else{for(var c=0;c<this.element.length;c++){var b=this.element[c];b.innerHTML=arguments[0]}return this}};this.replace=function(){for(var c=0;c<this.element.length;c++){var b=this.element[c];b.outerHTML=arguments[0]}return this};this.remove=function(){for(var c=0;c<this.element.length;c++){var b=this.element[c];b.outerHTML=""}return this};this.append=function(){for(var c=0;c<this.element.length;c++){var b=this.element[c];if(typeof arguments[0]=="string"){ch=document.createElement("div");ch.innerHTML=arguments[0];b.appendChild(ch.firstElementChild)}else{b.appendChild(arguments[0])}}return this};this.appendStart=function(){for(var c=0;c<this.element.length;c++){var b=this.element[c];b.innerHTML=arguments[0]+b.innerHTML}return this};this.css=function(){if(arguments.length===2){for(var c=0;c<this.element.length;c++){var b=this.element[c];b.style.cssText+=";"+arguments[0]+":"+arguments[1]+";"}}else{if(arguments.length===1){if(!(arguments[0].search(":")>=0||arguments[0].search(";")>=0)){return this._getStyle(this.element[0],arguments[0])}else{for(var c=0;c<this.element.length;c++){var b=this.element[c];b.style.cssText+=";"+arguments[0]+";"}}}}return this};this.toggleClass=function(){for(var c=0;c<this.element.length;c++){var b=this.element[c];b.classList.toggle(arguments[0])}return this};this.attr=function(){if(arguments.length===2){for(var c=0;c<this.element.length;c++){var b=this.element[c];b.setAttribute(arguments[0],arguments[1])}}else{if(arguments.length===1){if(this.element.length>0){var b=this.element[this.element.length-1];return b.getAttribute(arguments[0])}else{return}}}return this};this.removeAttr=function(){if(arguments.length===1){if(this.element.length>0){var b=this.element[this.element.length-1];b.removeAttribute(arguments[0])}else{return}}return this};this.val=function(){if(arguments.length===1){for(var c=0;c<this.element.length;c++){var b=this.element[c];b.value=arguments[0]}}else{if(arguments.length===0){return this.element[0].value}}return this};this.on=function(){for(var c=0;c<this.element.length;c++){var b=this.element[c];b.addEventListener(arguments[0],arguments[1].bind(b),true)}return this};this.off=function(){for(var c=0;c<this.element.length;c++){var b=this.element[c];b.removeEventListener(arguments[0],arguments[1].bind(b),true)}return this};this.click=function(){$(this).on("click",arguments[0]);return this};this.addClass=function(){for(var c=0;c<this.element.length;c++){var b=this.element[c];b.classList.add(arguments[0])}return this};this.removeClass=function(){for(var c=0;c<this.element.length;c++){var b=this.element[c];b.classList.remove(arguments[0])}return this};this.child=function(){if(typeof arguments[0]==="object"){if(arguments[0].hasOwnProperty("CUSTOME")){this.element=arguments[0].element}else{var b=array();for(var g=0;g<this.element.length;g++){var c=this.element[g];b.push.apply(temElement,c.querySelectorAll(arguments[0]))}this.element=b}}else{this.element=arguments[0]}return this};this.each=function(){var h=arguments[0];for(var g=0;g<this.element.length;g++){var c=this.element[g];var b=h.bind(c);b()}return this};this.focus=function(){for(var c=0;c<this.element.length;c++){var b=this.element[c];b.focus()}return this};return this}$.get=function(){console.log("A")};$.ajax=function(){var b=arguments[0];if(typeof b=="undefined"){b={}}if(!b.hasOwnProperty("type")){b.type="get"}if(!b.hasOwnProperty("url")){b.url="/"}if(!b.hasOwnProperty("async")){b.async=false}if(!b.hasOwnProperty("data")){b.data={}}if(!b.hasOwnProperty("readystatechange")){b.readystate=function(){}}if(!b.hasOwnProperty("success")){b.success=function(){}}if(!b.hasOwnProperty("failure")){b.failure=function(){}}if(!b.hasOwnProperty("start")){b.start=function(){}}if(!b.hasOwnProperty("end")){b.end=function(){}}if(!b.hasOwnProperty("dataType")){b.dataType="text"}if(!b.hasOwnProperty("contentType")){b.contentType="application/x-www-form-urlencoded"}b.type=b.type.toUpperCase();b.dataType=b.dataType.toUpperCase();if(b.data instanceof FormData){}else{url=Object.keys(b.data).map(function(c){return encodeURIComponent(c)+"="+encodeURIComponent(b.data[c])}).join("&");b.data=url}var a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");a.open(b.type,b.url,b.async);if(!(b.data instanceof FormData)){a.setRequestHeader("Content-type",b.contentType)}a.onreadystatechange=function(){b.readystate(a);if(a.readyState==4&&a.status==200){try{if(b.dataType=="TEXT"){b.success(a.responseText)}else{if(b.dataType=="HTML"){b.success(a.responseXML)}else{if(b.dataType=="JSON"){b.success(JSON.parse(a.responseText))}}}}catch(c){b.failure();e(c);e(a)}}if(a.readyState==4&&a.status!=200){b.failure()}if(a.readyState==4){b.end()}};b.start();a.send(b.data);return a};function trim(b,a){return"false"==typeof a&&(a=5),b=b.substr(0,a)}function changeAddr(a){window.history.pushState("","",a)}var config={scrollOffsetForLoadMore:300,scrollTimerForLoadMore:50,photoPerPage:12};var latestFullPhotoObject=null;var photoTemplate,fullPhotoTemplate,albumTemplate;photoTemplate='<div class="photoContainer" itemscope itemtype ="http://schema.org/ImageObject">            <div class="photo" id="photo_{{id}}" style="background-image: url(\'/public/images/thumb/{{img}}\')">            </div>            <div class="title">                <div class="titleText" itemprop="caption">{{title}}</div>                <div class="likeAndFavContainer">                    <ul class="hl">                        <li class="likeIcon">                            <img src="/public/images/img/like_normal.png" id="like_{{id}}" data-id="{{id}}">                            <img src="/public/images/img/like_highlight.png" id="dislike_{{id}}" data-id="{{id}}">                        </li>                        <li class="favIcon">                            <img src="/public/images/img/fav_normal.png" id="fav_{{id}}" data-id="{{id}}">                            <img src="/public/images/img/fav_highlight.png" id="unfav_{{id}}" data-id="{{id}}">                        </li>                    </ul>                </div>            </div>        </div>';fullPhotoTemplate='<div class="fullScreenPhoto">            <div class="close" onclick="closeFullScreenPhoto()">X</div>            <div class="photoHolder">                <div class="previousFullPhoto" id="previousFullPhoto">                    <span>&lt;</span>                </div>                <div class="nextFullPhoto" id="nextFullPhoto">                    <span>&gt;</span>                </div>                <img src="/public/images/compressed/{{img}}">            </div>            <div class="photoDetailHolder">                <div class="userInfo">                    <img src="/public/images/profile_img/{{user_img}}">                    <a href="/user/{{username}}">{{username}}</a>                </div>                <div class="title">{{title}}</div>                <div>                    <ul class="hl likeFavViewContainer">                        <li>                            <ul class="hl ">                                <li class="word" id="like_{{id}}">Like</li>                                <li class="word likehighlight" id="dislike_{{id}}">Like</li>                                <li class="count likehighlight" id="likeCount_{{id}}">12</li>                            </ul>                        </li>                        <li>                            <ul class="hl">                                <li class="word" id="fav_{{id}}">Favorite</li>                                <li class="word favhighlight" id="unfav_{{id}}">Favorite</li>                                <li class="count favhighlight" id="favCount_{{id}}">12</li>                            </ul>                        </li>                        <li>                            <ul class="hl">                                <li class="word">View</li><li class="count viewhighlight" id="viewCount_{{id}}">12</li>                            </ul>                        </li>                    </ul>                </div>                <div class="viewFullPhoto">                    <a href="/photo/{{url}}"><button>View Full Photo</button></a>                </div>                <div>                    <table class="photoDetailTable">                        <tbody><tr><th>Name</th><th>Description</th></tr>                        <tr><td>Album</td><td><a href="/album/{{albumurl}}" title="{{album}}">{{album}}</a></td></tr>                        <tr><td>Width</td><td>{{width}}</td></tr>                        <tr><td>Height</td><td>{{height}}</td></tr>                        <tr><td>Size</td><td>{{size}}</td></tr>                    </tbody></table>                </div><div class="fullPhotoColorPalatteTitle">Color Palette</div> <div id="fullPhotoColorPalatte" class="fullPhotoColorPalatte"></div>           </div>        </div>';albumTemplate='<div class="album">            <div class="albumTitle">                {{album}}                <a href="/album/{{albumurl}}" class="seeAll">See All Photo</a>            </div>            <a href="/album/{{albumurl}}">                <div class="imgage" style="background-image: url(/public/images/compressed/{{img}});"></div>            </a>        </div>';$(window).on("load",function(){$(window).on("click",function(){if($("#hiddenTopMoreOptionContainer").css("display")=="block"){toggleMoreOption()}})});function displayPhotos(c){for(photoJSONIndex in c.data){var b=c.data[photoJSONIndex];var g=b.title;g=g.replace(/#(\S*)/g,'<a href="/hash/$1">#$1</a>');var a=photoTemplate;a=a.replace(/\{\{id\}\}/g,b.imgid);a=a.replace(/\{\{title\}\}/g,g);a=a.replace(/\{\{img\}\}/g,b.img);$("#"+c.id).append(a);if(b.likecount=="0"){$("#like_"+b.imgid).show();$("#dislike_"+b.imgid).hide()}else{$("#like_"+b.imgid).hide();$("#dislike_"+b.imgid).show()}$("#like_"+b.imgid).on("click",likePhoto.bind(b));$("#dislike_"+b.imgid).on("click",dislikePhoto.bind(b));if(b.favcount=="0"){$("#fav_"+b.imgid).show();$("#unfav_"+b.imgid).hide()}else{$("#fav_"+b.imgid).hide();$("#unfav_"+b.imgid).show()}$("#fav_"+b.imgid).on("click",favPhoto.bind(b));$("#unfav_"+b.imgid).on("click",unfavPhoto.bind(b));$("#photo_"+b.imgid).on("click",showFullScreenPhoto.bind(b))}setTimeout(checkPhotoCountForEmptyAndThreshold,100)}function checkPhotoCountForEmptyAndThreshold(){if($(".photoContainer").length<config.photoPerPage){$("#messageFooter").show()}}function showFullScreenPhoto(){var a=this;$.ajax({type:"post",url:"/photo/info",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#fullScreenPhoto").show()},success:function(g){e(g);latestFullPhotoObject=g;if(g.code==1){var h=fullPhotoTemplate;var l=g.title;l=l.replace(/#(\S*)/g,'<a href="/hash/$1">#$1</a>');h=h.replace(/\{\{user_img\}\}/g,g.usericon);h=h.replace(/\{\{username\}\}/g,g.username);h=h.replace(/\{\{url\}\}/g,g.url);h=h.replace(/\{\{title\}\}/g,l);h=h.replace(/\{\{img\}\}/g,a.img);h=h.replace(/\{\{id\}\}/g,a.imgid);h=h.replace(/\{\{album\}\}/g,g.albumname);h=h.replace(/\{\{albumurl\}\}/g,g.albumurl);h=h.replace(/\{\{width\}\}/g,g.width);h=h.replace(/\{\{height\}\}/g,g.height);h=h.replace(/\{\{size\}\}/g,g.size);$("#fullScreenPhoto").text(h);$("#likeCount_"+a.imgid).text(g.likecount);$("#favCount_"+a.imgid).text(g.favcount);$("#viewCount_"+a.imgid).text(g.viewcount);if(g.userlike=="0"){$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide()}else{$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show()}if(g.userfav=="0"){$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide()}else{$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show()}$(window).on("keydown",instantCloseFullScreenPhoto);$("#like_"+a.imgid).on("click",fullScreenLikePhoto.bind(a));$("#dislike_"+a.imgid).on("click",fullScreenDislikePhoto.bind(a));$("#fav_"+a.imgid).on("click",fullScreenFavPhoto.bind(a));$("#unfav_"+a.imgid).on("click",fullScreenUnfavPhoto.bind(a));if(g.previous!=false){$("#previousFullPhoto").show();$("#previousFullPhoto").html("<span>&lt;</span>");$("#previousFullPhoto span").on("click",showFullScreenPhoto.bind(g.previous))}else{$("#previousFullPhoto").hide()}if(g.next!=false){$("#nextFullPhoto").show();$("#nextFullPhoto").html("<span>&gt;</span>");$("#nextFullPhoto span").on("click",showFullScreenPhoto.bind(g.next))}else{$("#nextFullPhoto").hide()}var k="";for(i=0;i<g.extra.length;i++){var b=g.extra[i];if(b.meta_key.startsWith("Palette_")){var c=(b.meta_value);k+="<div style='background-color:#"+c+"' class='paletteColorBox'></div>"}}$("#fullPhotoColorPalatte").text(k)}else{addMessageBox(1,g.message)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection")}})}function displayAlbums(c){for(albumJSONIndex in c.data){var a=c.data[albumJSONIndex];var b=albumTemplate;b=b.replace(/\{\{album\}\}/g,a.album);b=b.replace(/\{\{albumurl\}\}/g,a.albumurl);b=b.replace(/\{\{img\}\}/g,a.img);$("#"+c.id).append(b)}}function likePhoto(b){var a=this;$.ajax({type:"post",url:"/photo/like",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show()},success:function(c){if(c.code==1){$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show()}else{$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide();addMessageBox(1,c.message)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide()}})}function dislikePhoto(){var a=this;$.ajax({type:"post",url:"/photo/dislike",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide()},success:function(b){if(b.code==1){$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide()}else{$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show();addMessageBox(1,b.message)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show()}})}function favPhoto(){var a=this;$.ajax({type:"post",url:"/photo/fav",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show()},success:function(b){if(b.code==1){$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show()}else{$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide();addMessageBox(1,b.message)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide()}})}function unfavPhoto(){var a=this;$.ajax({type:"post",url:"/photo/unfav",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide()},success:function(b){if(b.code==1){$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide()}else{$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show();addMessageBox(1,b.message)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show()}})}function fullScreenLikePhoto(){var a=this;$.ajax({type:"post",url:"/photo/like",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show();var b=parseInt($("#likeCount_"+a.imgid).text());b++;$("#likeCount_"+a.imgid).text(b)},success:function(b){if(b.code==1){$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show()}else{$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide();addMessageBox(1,b.message);var c=parseInt($("#likeCount_"+a.imgid).text());c--;$("#likeCount_"+a.imgid).text(c)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide();var b=parseInt($("#likeCount_"+a.imgid).text());b--;$("#likeCount_"+a.imgid).text(b)}})}function fullScreenDislikePhoto(){var a=this;$.ajax({type:"post",url:"/photo/dislike",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide();var b=parseInt($("#likeCount_"+a.imgid).text());b--;$("#likeCount_"+a.imgid).text(b)},success:function(b){if(b.code==1){$("#like_"+a.imgid).show();$("#dislike_"+a.imgid).hide()}else{$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show();addMessageBox(1,b.message);var c=parseInt($("#likeCount_"+a.imgid).text());c++;$("#likeCount_"+a.imgid).text(c)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#like_"+a.imgid).hide();$("#dislike_"+a.imgid).show();var b=parseInt($("#likeCount_"+a.imgid).text());b++;$("#likeCount_"+a.imgid).text(b)}})}function fullScreenFavPhoto(){var a=this;$.ajax({type:"post",url:"/photo/fav",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show();var b=parseInt($("#favCount_"+a.imgid).text());b++;$("#favCount_"+a.imgid).text(b)},success:function(b){if(b.code==1){$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show()}else{$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide();addMessageBox(1,b.message);var c=parseInt($("#favCount_"+a.imgid).text());c--;$("#favCount_"+a.imgid).text(c)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide();var b=parseInt($("#favCount_"+a.imgid).text());b--;$("#favCount_"+a.imgid).text(b)}})}function fullScreenUnfavPhoto(){var a=this;$.ajax({type:"post",url:"/photo/unfav",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide();var b=parseInt($("#favCount_"+a.imgid).text());b--;$("#favCount_"+a.imgid).text(b)},success:function(b){if(b.code==1){$("#fav_"+a.imgid).show();$("#unfav_"+a.imgid).hide()}else{$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show();addMessageBox(1,b.message);var c=parseInt($("#favCount_"+a.imgid).text());c++;$("#favCount_"+a.imgid).text(c)}},end:function(){},failure:function(){addMessageBox(1,"No Internet Connection");$("#fav_"+a.imgid).hide();$("#unfav_"+a.imgid).show();var b=parseInt($("#favCount_"+a.imgid).text());b++;$("#favCount_"+a.imgid).text(b)}})}function closeFullScreenPhoto(){$("#fullScreenPhoto").hide();$(window).off("keydown",instantCloseFullScreenPhoto)}function instantCloseFullScreenPhoto(){if(event.keyCode==27){closeFullScreenPhoto()}}function toggleMoreOption(){$("#hiddenTopMoreOptionContainer").toggle()}function addMessageBox(a,g){id="messageBox_"+(new Date()).getTime()+Math.ceil(Math.random()*200);var c='<div class="messageBox '+((a===0)?"messageBoxGreen":"messageBoxRed")+'" id="'+id+'">                <ul class="hl">                    <li>'+g+'</li>                    <li class="close" onclick="closeMessageBox(\''+id+"')\">x</li>                </ul>            </div>";$("#rightMessageBox").appendStart(c);var b={boxid:id};f=showMessageBox.bind(b);setTimeout(f,0)}function showMessageBox(){$("#"+this.boxid).css("opacity:1;");f=hideMessageBox.bind(this);setTimeout(f,3000)}function hideMessageBox(){$("#"+this.boxid).css("opacity:0;");f=removeMessageBox.bind(this);setTimeout(f,500)}function removeMessageBox(){$("#"+this.boxid).remove()}function closeMessageBox(b){var a={boxid:b};f=hideMessageBox.bind(a);setTimeout(f,0)}function userAlbumScrollHandlerWithTime(){clearInterval(userAlbumScrollTimer);userAlbumScrollTimer=setTimeout(userAlbumScrollHandler,config.scrollTimerForLoadMore)}function userAlbumScrollHandler(){var g=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var c=(document.documentElement&&document.documentElement.scrollHeight)||document.body.scrollHeight;var b=(g+window.innerHeight+config.scrollOffsetForLoadMore)>=c;var a=$("#messageFooter").css("display")=="block"?true:false;if(b&&!a){userAlbumLoadMore()}}function userAlbumLoadMore(){var a=albumsJSON[albumsJSON.length-1];if(latestPhotoSent==a){return}else{latestPhotoSent=a;$.ajax({type:"post",url:"/user/more",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#loadingFooter").show();$("#retryFooter").hide()},success:function(b){e(b);if(b.code==1){albumsJSON.push.apply(albumsJSON,b.photos);displayAlbums({data:b.photos,id:"albumContainer"});if(b.photos.length==0){$(window).off("scroll",userAlbumScrollHandlerWithTime);$("#messageFooter").show()}else{$("#messageFooter").hide()}}else{addMessageBox(1,b.message)}},end:function(){$("#loadingFooter").hide();latestPhotoSent=null},failure:function(){$("#retryFooter").show()}})}}function userPhotoScrollHandlerWithTime(){clearInterval(userPhotoScrollTimer);userPhotoScrollTimer=setTimeout(userPhotoScrollHandler,config.scrollTimerForLoadMore)}function userPhotoScrollHandler(){var g=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var c=(document.documentElement&&document.documentElement.scrollHeight)||document.body.scrollHeight;var b=(g+window.innerHeight+config.scrollOffsetForLoadMore)>=c;var a=$("#messageFooter").css("display")=="block"?true:false;if(b&&!a){userPhotoLoadMore()}}function userPhotoLoadMore(){var a=photosJSON[photosJSON.length-1];$.ajax({type:"post",url:"/user/more",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#loadingFooter").show();$("#retryFooter").hide()},success:function(b){if(b.code==1){photosJSON.push.apply(photosJSON,b.photos);displayPhotos({data:b.photos,id:"photoContainer"});if(b.photos.length==0){$(window).off("scroll",userPhotoScrollHandlerWithTime);$("#messageFooter").show()}else{$("#messageFooter").hide()}}else{addMessageBox(1,b.message)}},end:function(){$("#loadingFooter").hide()},failure:function(){$("#retryFooter").show()}})}function homeScrollHandlerWithTime(){clearInterval(homeScrollTimer);homeScrollTimer=setTimeout(homeScrollHandler,config.scrollTimerForLoadMore)}function homeScrollHandler(){var g=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var c=(document.documentElement&&document.documentElement.scrollHeight)||document.body.scrollHeight;var b=(g+window.innerHeight+config.scrollOffsetForLoadMore)>=c;var a=$("#messageFooter").css("display")=="block"?true:false;if(b&&!a){homeLoadMore()}}var latestPhotoSent;function homeLoadMore(){var a=photosJSON[photosJSON.length-1];if(latestPhotoSent==a){return}else{latestPhotoSent=a;$.ajax({type:"post",url:"/home/more",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#loadingFooter").show();$("#retryFooter").hide()},success:function(b){if(b.code==1){photosJSON.push.apply(photosJSON,b.photos);displayPhotos({data:b.photos,id:"photoContainer"});if(b.photos.length==0){$("#messageFooter").show()}else{$("#messageFooter").hide()}}else{addMessageBox(1,b.message)}},end:function(){$("#loadingFooter").hide();latestPhotoSent=null},failure:function(){$("#retryFooter").show()}})}}function hashScrollHandlerWithTime(){clearInterval(hashScrollTimer);hashScrollTimer=setTimeout(hashScrollHandler,config.scrollTimerForLoadMore)}function hashScrollHandler(){var g=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var c=(document.documentElement&&document.documentElement.scrollHeight)||document.body.scrollHeight;var b=(g+window.innerHeight+config.scrollOffsetForLoadMore)>=c;var a=$("#messageFooter").css("display")=="block"?true:false;if(b&&!a){hashLoadMore()}}function hashLoadMore(){var a=photosJSON[photosJSON.length-1];if(latestPhotoSent==a){return}else{latestPhotoSent=a;$.ajax({type:"post",url:"/hash/more",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#loadingFooter").show();$("#retryFooter").hide()},success:function(b){if(b.code==1){photosJSON.push.apply(photosJSON,b.photos);displayPhotos({data:b.photos,id:"photoContainer"});if(b.photos.length==0){$("#messageFooter").show()}else{$("#messageFooter").hide()}}else{addMessageBox(1,b.message)}},end:function(){$("#loadingFooter").hide();latestPhotoSent=null},failure:function(){$("#retryFooter").show()}})}}function albumScrollHandlerWithTime(){clearInterval(albumScrollTimer);albumScrollTimer=setTimeout(albumScrollHandler,config.scrollTimerForLoadMore)}function albumScrollHandler(){var g=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var c=(document.documentElement&&document.documentElement.scrollHeight)||document.body.scrollHeight;var b=(g+window.innerHeight+config.scrollOffsetForLoadMore)>=c;var a=$("#messageFooter").css("display")=="block"?true:false;if(b&&!a){albumLoadMore()}}function albumLoadMore(){var a=photosJSON[photosJSON.length-1];if(latestPhotoSent==a){return}else{latestPhotoSent=a;$.ajax({type:"post",url:"/album/more",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#loadingFooter").show();$("#retryFooter").hide()},success:function(b){if(b.code==1){photosJSON.push.apply(photosJSON,b.photos);displayPhotos({data:b.photos,id:"photoContainer"});if(b.photos.length==0){$("#messageFooter").show()}else{$("#messageFooter").hide()}}else{addMessageBox(1,b.message)}},end:function(){$("#loadingFooter").hide();latestPhotoSent=null},failure:function(){$("#retryFooter").show()}})}}function editorScrollHandlerWithTime(){clearInterval(editorScrollTimer);editorScrollTimer=setTimeout(editorScrollHandler,config.scrollTimerForLoadMore)}function editorScrollHandler(){var g=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var c=(document.documentElement&&document.documentElement.scrollHeight)||document.body.scrollHeight;var b=(g+window.innerHeight+config.scrollOffsetForLoadMore)>=c;var a=$("#messageFooter").css("display")=="block"?true:false;if(b&&!a){editorLoadMore()}}function editorLoadMore(){var a=photosJSON[photosJSON.length-1];if(latestPhotoSent==a){return}else{latestPhotoSent=a;$.ajax({type:"post",url:"/editor/more",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#loadingFooter").show();$("#retryFooter").hide()},success:function(b){if(b.code==1){photosJSON.push.apply(photosJSON,b.photos);displayPhotos({data:b.photos,id:"photoContainer"});if(b.photos.length==0){$("#messageFooter").show()}else{$("#messageFooter").hide()}}else{addMessageBox(1,b.message)}},end:function(){$("#loadingFooter").hide();latestPhotoSent=null},failure:function(){$("#retryFooter").show()}})}}function saveUserProfileCover(){var c=document.getElementById("userCoverUploadFile");var b=c.files[0];if(b.type==undefined||b.size==0){addMessageBox(1,"Unknown File");return}var a=new FormData();a.append("cover",b);ajax=new XMLHttpRequest();ajax.upload.addEventListener("progress",profileProgressHandler,false);ajax.addEventListener("load",profileCompleteHandler,false);ajax.open("POST","/upload/cover");ajax.send(a)}function profileProgressHandler(b){var a=(b.loaded/b.total)*100;$("#uploadProgressBar").css("width:"+a+"%")}function profileCompleteHandler(a){$("#uploadProgressBar").css("width:0%");rawInfo=ajax.responseText;info=JSON.parse(ajax.responseText);if(info.code==101){window.location.href="/account/login"}else{if(info.code==1){addMessageBox(0,info.message)}else{addMessageBox(1,info.message)}}$("#changeUserProfileCoverSave").hide()}function saveUserProfileIcon(){var c=document.getElementById("userIconUploadFile");var b=c.files[0];if(b.type==undefined||b.size==0){addMessageBox(1,"Unknown File");return}var a=new FormData();a.append("cover",b);ajax=new XMLHttpRequest();ajax.upload.addEventListener("progress",profileIconProgressHandler,false);ajax.addEventListener("load",profileIconCompleteHandler,false);ajax.open("POST","/upload/icon");ajax.send(a)}function profileIconProgressHandler(b){var a=(b.loaded/b.total)*100;$("#uploadProgressBar").css("width:"+a+"%")}function profileIconCompleteHandler(a){$("#uploadProgressBar").css("width:0%");rawInfo=ajax.responseText;info=JSON.parse(ajax.responseText);if(info.code==101){window.location.href="/account/login"}else{if(info.code==1){addMessageBox(0,info.message)}else{addMessageBox(1,info.message)}}$("#changeUserProfileIconSave").hide()}function showPreviewProfileCover(){var h=document.getElementById("userCoverUploadFile");if(h.files&&h.files[0]){for(j=0;j<h.files.length;j++){var g,k,c,b=new FileReader;b.onload=function(l){var m=l.target.result;d=document.createElement("img");d.src=m;g=d.width;k=d.height;c=l.size;$("#userProfileCoverPhoto").css("background-image:url("+d.src+")");$("#changeUserProfileCoverSave").show()},b.onerror=function(a){console.error("File could not be read! Code "+a.target.error.code)},b.readAsDataURL(h.files[j])}}}function showPreviewProfileIcon(){var h=document.getElementById("userIconUploadFile");if(h.files&&h.files[0]){for(j=0;j<h.files.length;j++){var g,k,c,b=new FileReader;b.onload=function(l){var m=l.target.result;d=document.createElement("img");d.src=m;g=d.width;k=d.height;c=l.size;$("#userProfileIconPhoto").css("background-image:url("+d.src+")");$("#changeUserProfileIconSave").show()},b.onerror=function(a){console.error("File could not be read! Code "+a.target.error.code)},b.readAsDataURL(h.files[j])}}}function instantSearch(){clearInterval(searchPhotoTimer);searchPhotoTimer=setTimeout(searchPhoto,20)}function searchPhoto(){var b=$("#searchBoxINput").val();var c=$("#searchType").val();var g=window.location.search;g=replaceQueryParam("search",b,g);g=replaceQueryParam("type",c.toLowerCase(),g);if(history.pushState){var a=window.location.protocol+"//"+window.location.host+window.location.pathname+g;window.history.pushState({path:a},"",a)}$.ajax({type:"post",url:"/search/get",async:true,dataType:"json",data:{searchTerm:b,searchType:c},start:function(){$("#messageFooter").hide()},success:function(h){e(h);if(h.code==1){if(h.type=="photo"){$("#photoContainer").html("");photosJSON.push.apply(photosJSON,h.photos);displayPhotos({data:h.photos,id:"photoContainer"})}else{if(h.type=="user"){$("#photoContainer").html("");userJSON.push.apply(userJSON,h.users);displayUser({data:h.users,id:"photoContainer"})}}$("#searchQueryExecutionTime").text("Search took "+h.query_time+" seconds")}else{addMessageBox(1,h.message)}},end:function(){},failure:function(){}})}function displayUser(b){for(photoJSONIndex in b.data){var c=b.data[photoJSONIndex];var a=$("#userSearchTemplate").text();a=a.replace(/\{\{img\}\}/g,c.img);a=a.replace(/\{\{cover\}\}/g,c.cover);a=a.replace(/\{\{username\}\}/g,c.username);$("#"+b.id).append(a)}setTimeout(checkUserCountForEmptyAndThreshold,100)}function checkUserCountForEmptyAndThreshold(){if($(".userSearch").length<config.photoPerPage){$("#messageFooter").show()}}function searchScrollHandlerWithTime(){clearInterval(searchScrollTimer);searchScrollTimer=setTimeout(searchScrollHandler,50)}function searchScrollHandler(){var g=(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var c=(document.documentElement&&document.documentElement.scrollHeight)||document.body.scrollHeight;var b=(g+window.innerHeight+200)>=c;var a=$("#messageFooter").css("display")=="block"?true:false;if(b&&!a){searchLoadMore()}}function searchLoadMore(){var b=$("#searchType").val();if(b=="photo"){var a=photosJSON[photosJSON.length-1]}else{var a=userJSON[userJSON.length-1]}if(latestPhotoSent==a){return}else{latestPhotoSent=a;$.ajax({type:"post",url:"/search/more",async:true,dataType:"json",data:{photo:JSON.stringify(a)},start:function(){$("#loadingFooter").show();$("#retryFooter").hide();$("#messageFooter").hide()},success:function(c){e(c);if(c.code==1){if(c.type=="photo"){photosJSON.push.apply(photosJSON,c.photos);displayPhotos({data:c.photos,id:"photoContainer"});if(c.photos.length==0){$("#messageFooter").show()}else{$("#messageFooter").hide()}}else{if(c.type=="people"){userJSON.push.apply(userJSON,c.users);displayUser({data:c.users,id:"photoContainer"});if(c.users.length==0){$("#messageFooter").show()}else{$("#messageFooter").hide()}}}}else{addMessageBox(1,c.message)}},end:function(){$("#loadingFooter").hide();latestPhotoSent=null},failure:function(){$("#retryFooter").show()}})}}function replaceQueryParam(h,g,a){var b=new RegExp("([?;&])"+h+"[^&;]*[;&]?");var c=a.replace(b,"$1").replace(/&$/,"");return(c.length>2?c+"&":"?")+(g?h+"="+g:"")};